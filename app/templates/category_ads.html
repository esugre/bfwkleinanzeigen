{% extends "base.html" %}

{% block content %}
<div class="layout-with-sidebar">

  {# --- Sidebar mit Kategorien --- #}
  <aside class="sidebar">
    <h3>Kategorien</h3>
    <ul>
      <li class="{% if not active_category %}active{% endif %}">
        <a href="{{ url_for('index') }}">Alle Anzeigen</a>
      </li>
      {% for cat in categories %}
        <li class="{% if active_category and active_category.category_id == cat.category_id %}active{% endif %}">
          <a href="{{ url_for('ads_by_category', category_id=cat.category_id) }}">
            {{ cat.name }}
          </a>
        </li>
      {% endfor %}
    </ul>
  </aside>

  {# --- Hauptbereich mit gefilterten Anzeigen --- #}
  <main class="ad-list-wrapper">
    <h1>Anzeigen in Kategorie: {{ active_category.name }}</h1>

    {% if ads|length == 0 %}
      <p>In dieser Kategorie gibt es aktuell keine Anzeigen.</p>
    {% else %}
      <div class="ad-list">
        {% for ad in ads %}
          <article class="ad-card">
            <a class="card-link" href="{{ url_for('ad_detail', ad_id=ad.ad_id) }}"></a>

            {% if ad.bilder_path %}
              <img 
                src="/{{ ad.bilder_path }}" 
                alt="{{ ad.titel }}" 
                class="ad-image"
              >
            {% endif %}

            <h2 class="ad-title">
              <a href="{{ url_for('ad_detail', ad_id=ad.ad_id) }}">
                {{ ad.titel }}
              </a>
            </h2>

            {% if ad.preis is not none %}
              <p class="ad-price"><strong>{{ "%.2f"|format(ad.preis|float) }} €</strong></p>
            {% else %}
              <p class="ad-price">Preis: n. V.</p>
            {% endif %}

            <p class="ad-excerpt">
              {{ ad.text[:140] }}{% if ad.text|length > 140 %}…{% endif %}
            </p>

            {% if ad.categories %}
              <div class="ad-tags">
                {% for cat in ad.categories %}
                  <span class="ad-tag">
                    <a href="{{ url_for('ads_by_category', category_id=cat.category_id) }}">
                      {{ cat.name }}
                    </a>
                  </span>
                {% endfor %}
              </div>
            {% endif %}

            <p class="ad-meta">
              von {{ ad.vorname }} {{ ad.nachname }} · {{ ad.datum }}
            </p>
          </article>
        {% endfor %}
      </div>
    {% endif %}
  </main>

</div>
{% endblock %}
